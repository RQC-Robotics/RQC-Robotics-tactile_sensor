schema: '2.0'
stages:
  simulate:
    cmd: python dvc_sim_runner.py
    deps:
    - path: data/pressure/batched_pic
      md5: e15f48d4b08a06ddb2ddc24b541e1134.dir
      size: 8192064000
      nfiles: 500
    - path: dvc_sim_runner.py
      md5: 01d0d7f020a712148979871a96168057
      size: 1201
    params:
      params.yaml:
        dataset.pic_path: data/pressure/pic
        dataset.signal_path: data/sensor_signal
        env.phys:
          fiber_sensibility:
            value: 0.6
            accuracy: 5
          kof: 1
          relative_noise: 0.01
          noise: 0.01
        env.sen_geometry:
          distance: 0.5
          x_len: 64
          y_len: 64
          n_angles: 4
          n_spl: 1
        random_seed: 4732
        sim:
          pic_path: data/pressure/batched_pic
          random_rot: 1
          batch_size: 1000
          test_size: None
          test_mod: false
    outs:
    - path: data/sensor_signal
      md5: 0b5c3ae91b073162e9607774940a4305.dir
      size: 512064000
      nfiles: 500
  learning:
    cmd: python dvc_model_learning.py
    deps:
    - path: data/sensor_signal
      md5: 79bf8bd89eda5db6b3b2a6f448448b6a.dir
      size: 1024128
      nfiles: 1
    - path: dvc_model_learning.py
      md5: 2e3234fcc2ae162e5b6b22afe9964f83
      size: 7173
    - path: torch_sensor_lib/nets.py
      md5: 8a697ab7b311e5cff0bf440686caedb6
      size: 2936
    params:
      params.yaml:
        train:
          batch_size: 7
          learning_rate: 0.0001
          n_epochs: 2
          model_name: TorchSensorNN5S_norm_deep
          test_size: None
    outs:
    - path: data/model
      md5: c6201d6539fbf601191ad1979272f4b9.dir
      size: 16205768
      nfiles: 1
    - path: reports/learning_curve.csv
      md5: 36c506673267c50badf92a9d70b4afa3
      size: 103
    - path: reports/summary.json
      md5: a8c5ade54b7adb67a158be580618b33e
      size: 79
  make_plot:
    cmd: dvc plots diff 973a7c --x-label "epochs" --y-label "loss"
    deps:
    - path: reports/learning_curve.csv
      md5: 36c506673267c50badf92a9d70b4afa3
      size: 103
    outs:
    - path: dvc_plots/index.html
      md5: d0d3e75dfd8b4d3f7a61aa1364b387b8
      size: 7676
  evaluate:
    cmd: python3 dvc_evaluate_model.py
    deps:
    - path: data/model
      md5: 0ef1bb24d4242dd46903ac12a4b2a04d.dir
      size: 13352783
      nfiles: 1
    outs:
    - path: reports/l_curve.png
      md5: b62887387552fa6f9955f029da3d0162
      size: 65073
    - path: reports/predict_examples.png
      md5: 066f179c4e09092e1b44a9e027a9d39c
      size: 400472
    - path: reports/report.md
      md5: 4deb09523db60548c3e1abfdc5dd0cf8
      size: 643
  profile_generation:
    cmd: python dvc_pressure_map_gen.py
    deps:
    - path: dvc_pressure_map_gen.py
      md5: b964ef9c36d196d477e7583716bcd78d
      size: 2076
    params:
      params.yaml:
        dataset.n_samples: 1000
        env.pressure_profile:
          n_gauses: 10
          size_kof: 5
        env.sen_geometry.x_len: 64
        env.sen_geometry.y_len: 64
        gengaus:
          batch_size: 100
          save_batch_size: None
        random_seed: 4732
    outs:
    - path: data/pressure/pic
      md5: 93326f4d0dc01b23ff035d4057b84e4c.dir
      size: 16384128
      nfiles: 1
  batch_splitting:
    cmd: python dvc_sim_batch_split.py
    deps:
    - path: data/pressure/pic
      md5: 93326f4d0dc01b23ff035d4057b84e4c.dir
      size: 16384128
      nfiles: 1
    - path: dvc_sim_batch_split.py
      md5: a7dae22c596ce5e964b94a946010c059
      size: 1048
    params:
      params.yaml:
        sim.batch_size: 100
    outs:
    - path: data/pressure/batched_pic
      md5: 4d557bccde08a3283a58293c0b1a782f.dir
      size: 16385280
      nfiles: 10
  simulation:
    cmd: python dvc_sim_runner.py
    deps:
    - path: data/pressure/pic
      md5: 93326f4d0dc01b23ff035d4057b84e4c.dir
      size: 16384128
      nfiles: 1
    - path: dvc_sim_runner.py
      md5: 543643a646a1fa10e1437351b7535f0c
      size: 1363
    params:
      params.yaml:
        env.phys:
          fiber_sensibility:
            value: 0.6
            accuracy: 5
          kof: 1
          relative_noise: 0.0
          noise: 0.0
        env.sen_geometry:
          distance: 0.5
          x_len: 64
          y_len: 64
          n_angles: 4
          n_spl: 1
        random_seed: 4732
        sim:
          random_rot: 1
          batch_size: 100
          test_size: None
          test_mod: false
    outs:
    - path: data/sensor_signal
      md5: 4007c88af5dfa17fc9b933e19e0367c1.dir
      size: 1024128
      nfiles: 1
  evaluation:
    cmd: python dvc_evaluate_model.py
    deps:
    - path: data/model
      md5: c6201d6539fbf601191ad1979272f4b9.dir
      size: 16205768
      nfiles: 1
    - path: dvc_evaluate_model.py
      md5: 4bbc024027e5540d52a5d7fd266a9773
      size: 5475
    outs:
    - path: logsdir
      md5: 0886ef72696b038960072d60b0440658.dir
      size: 29992
      nfiles: 1
    - path: reports/l_curve.png
      md5: f227cdcc7f30fc6bb85f687b69141992
      size: 33926
    - path: reports/predict_examples.jpg
      md5: a1f9d9736d2e66e8ec99bad4aafd3a98
      size: 65959
    - path: reports/report.md
      md5: 1dbea1158658df87c4ce21af98f9c12b
      size: 5162
  video_learning:
    cmd: python video_pipeline/learning.py
    deps:
    - path: data/video/test_signal
      md5: 794aa7c47554ee4f6b107b7f409c11cc.dir
      size: 30920890
      nfiles: 1088
    - path: data/video/train_signal
      md5: aa68f3e3ac2f04b0a23fb194a41724d0.dir
      size: 371901556
      nfiles: 11708
    params:
      params.yaml:
        video_train:
          batch_size: 1000
          learning_rate: 0.0001
          epochs: 40
          model_name: ParamStackNet
          layers:
          - - 300
            - 100
          - - 500
            - 200
            - 200
            - 500
          frames_number: 5
          frames_interval: 5
    outs:
    - path: data/v_model
      md5: c8869842fc0e8c43b01840b590a9cbca.dir
      size: 4454267
      nfiles: 1
    - path: reports/full_test_loss.csv
      md5: a160157270791c2a7bd97b485fcbb5d2
      size: 882
    - path: reports/full_train_loss.csv
      md5: 9eaa7be8085a16ea822fe03db851ed62
      size: 867
    - path: reports/v_summary.json
      md5: 5dc859f5daa55dcc0bdc88e5bc1838aa
      size: 83
  video_sim:
    cmd: python video_pipeline/video_sim_runner.py
    deps:
    - path: data/video/pressure
      md5: 1286041c65abff46be3102fa604de0f2.dir
      size: 755165093
      nfiles: 12796
    - path: video_pipeline/video_sim_runner.py
      md5: 7bdd1f652da8882acb8ea6361fc3892b
      size: 2621
    params:
      params.yaml:
        dataset.test_frac: 0.1
        dataset.test_items:
        env.phys:
          fiber_sensibility:
            value: 0.5
          kof: 1
          gaus_kernel_size: 3
          relative_noise: 0.0
          noise: 0.0
        env.sen_geometry.n_angles: 4
    outs:
    - path: data/video/test_signal
      md5: 794aa7c47554ee4f6b107b7f409c11cc.dir
      size: 30920890
      nfiles: 1088
    - path: data/video/train_signal
      md5: aa68f3e3ac2f04b0a23fb194a41724d0.dir
      size: 371901556
      nfiles: 11708
  prepare_dataset:
    cmd: python video_pipeline/prepare_dataset.py
    deps:
    - path: data/videos_from_isaac
      md5: 0977ed579f3f3efed8988e1a2c721cb2.dir
      size: 650706739
      nfiles: 12796
    - path: video_pipeline/prepare_dataset.py
      md5: 35a30578275103c397e54838c65dab1a
      size: 1776
    outs:
    - path: data/video/pressure
      md5: 1286041c65abff46be3102fa604de0f2.dir
      size: 755165093
      nfiles: 12796
  visual:
    cmd: python video_pipeline/prediction_visualization.py; git add reports
    deps:
    - path: data/v_model
      md5: c8869842fc0e8c43b01840b590a9cbca.dir
      size: 4454267
      nfiles: 1
    params:
      params.yaml:
        visual:
          test:
            step: 32
            max_items: 128
          train:
            step: 32
            max_items: 32
    outs:
    - path: data/video/predict_vis
      md5: dba41c0f3e9cedf61c86b986186ab897.dir
      size: 20701262
      nfiles: 67
  push_logs:
    cmd: python csv_logger.py
