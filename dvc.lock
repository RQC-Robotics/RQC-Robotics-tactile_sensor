schema: '2.0'
stages:
  simulate:
    cmd: python dvc_sim_runner.py
    deps:
    - path: data/pressure/batched_pic
      md5: e15f48d4b08a06ddb2ddc24b541e1134.dir
      size: 8192064000
      nfiles: 500
    - path: dvc_sim_runner.py
      md5: 01d0d7f020a712148979871a96168057
      size: 1201
    params:
      params.yaml:
        dataset.pic_path: data/pressure/pic
        dataset.signal_path: data/sensor_signal
        env.phys:
          fiber_sensibility:
            value: 0.6
            accuracy: 5
          kof: 1
          relative_noise: 0.01
          noise: 0.01
        env.sen_geometry:
          distance: 0.5
          x_len: 64
          y_len: 64
          n_angles: 4
          n_spl: 1
        random_seed: 4732
        sim:
          pic_path: data/pressure/batched_pic
          random_rot: 1
          batch_size: 1000
          test_size: None
          test_mod: false
    outs:
    - path: data/sensor_signal
      md5: 0b5c3ae91b073162e9607774940a4305.dir
      size: 512064000
      nfiles: 500
  learning:
    cmd: python dvc_model_learning.py
    deps:
    - path: data/sensor_signal
      md5: d99037e37fed6a8ca9576c13ef121c40.dir
      size: 102400128
      nfiles: 1
    - path: dvc_model_learning.py
      md5: 737740ba96d60ae6b8f210b21920fb56
      size: 7463
    - path: torch_sensor_lib/nets.py
      md5: f2b93cfdd9d61107f9591a61c388daf1
      size: 5317
    params:
      params.yaml:
        train:
          batch_size: 200
          learning_rate: 0.0001
          cycle_loss_alpha: 0
          n_epochs: 100
          model_name: TorchSensorNN5S_norm_deep
          test_size: None
    outs:
    - path: data/model
      md5: 8c5e49048873900c5869189c5837bd87.dir
      size: 16120136
      nfiles: 1
    - path: reports/learning_curve.csv
      md5: b55a00c092cab3fa9504b94ff20c2777
      size: 4136
    - path: reports/summary.json
      md5: b07379d2ab73c001806d2178380e2908
      size: 80
  make_plot:
    cmd: dvc plots diff 9a8d6 --x-label "epochs" --y-label "loss"
    deps:
    - path: reports/learning_curve.csv
      md5: c1f278427cadc43854281079818e4aed
      size: 432
    outs:
    - path: dvc_plots/index.html
      md5: 6d4f98b47890bece967f2ffafeaf020f
      size: 9009
  evaluate:
    cmd: python3 dvc_evaluate_model.py
    deps:
    - path: data/model
      md5: 0ef1bb24d4242dd46903ac12a4b2a04d.dir
      size: 13352783
      nfiles: 1
    outs:
    - path: reports/l_curve.png
      md5: b62887387552fa6f9955f029da3d0162
      size: 65073
    - path: reports/predict_examples.png
      md5: 066f179c4e09092e1b44a9e027a9d39c
      size: 400472
    - path: reports/report.md
      md5: 4deb09523db60548c3e1abfdc5dd0cf8
      size: 643
  profile_generation:
    cmd: python dvc_pressure_map_gen.py
    deps:
    - path: dvc_pressure_map_gen.py
      md5: b964ef9c36d196d477e7583716bcd78d
      size: 2076
    params:
      params.yaml:
        dataset.n_samples: 100000
        env.pressure_profile:
          n_gauses: 7
          size_kof: 5
          g_param_path: data/gaus_param.npy
        env.sen_geometry.x_len: 64
        env.sen_geometry.y_len: 64
        gengaus:
          batch_size: 1000
          save_batch_size: None
        random_seed: 4732
    outs:
    - path: data/pressure/pic
      md5: 21855d841b0f2480fce69caf98754959.dir
      size: 1638400128
      nfiles: 1
  batch_splitting:
    cmd: python dvc_sim_batch_split.py
    deps:
    - path: data/pressure/pic
      md5: 4bd5ea81862423ca05d28572b69fd5ba.dir
      size: 8192000128
      nfiles: 1
    - path: dvc_sim_batch_split.py
      md5: a7dae22c596ce5e964b94a946010c059
      size: 1048
    params:
      params.yaml:
        sim.batch_size: 500
    outs:
    - path: data/pressure/batched_pic
      md5: b5acb9420942f1e22ab90c6589f61a5f.dir
      size: 8192128000
      nfiles: 1000
  simulation:
    cmd: python dvc_sim_runner.py
    deps:
    - path: data/pressure/pic
      md5: 21855d841b0f2480fce69caf98754959.dir
      size: 1638400128
      nfiles: 1
    - path: dvc_sim_runner.py
      md5: 543643a646a1fa10e1437351b7535f0c
      size: 1363
    params:
      params.yaml:
        env.phys:
          fiber_sensibility:
            value: 0.6
            accuracy: 5
          kof: 1
          relative_noise: 0.0
          noise: 0.0
        env.sen_geometry:
          distance: 0.5
          x_len: 64
          y_len: 64
          n_angles: 4
          n_spl: 1
        random_seed: 4732
        sim:
          random_rot: 1
          batch_size: 500
          test_size: 1
          test_mod: false
    outs:
    - path: data/sensor_signal
      md5: d99037e37fed6a8ca9576c13ef121c40.dir
      size: 102400128
      nfiles: 1
  evaluation:
    cmd: python dvc_evaluate_model.py
    deps:
    - path: data/model
      md5: 8c5e49048873900c5869189c5837bd87.dir
      size: 16120136
      nfiles: 1
    - path: dvc_evaluate_model.py
      md5: 0f96a9b381bd1cd58113efc123a86d2a
      size: 5688
    outs:
    - path: logsdir
      md5: 3832b8255f1e2d0c3a655d8a1ad09eba.dir
      size: 40
      nfiles: 1
    - path: reports/l_curve.png
      md5: 3413aae3dba8365e5d3cac86dcb533dd
      size: 30911
    - path: reports/predict_examples.jpg
      md5: 6000966403a6470f4d9637950641a57d
      size: 53665
    - path: reports/rand_examples.jpg
      md5: f9ade2b6f7c4723c4e93bfd229c8502c
      size: 212534
    - path: reports/rand_train_examples.jpg
      md5: cf05cfb76ff247251b721a61c5c77caf
      size: 191055
    - path: reports/report.md
      md5: d90d16e396116cc9fd03504f740e2fd8
      size: 5109
