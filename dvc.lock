schema: '2.0'
stages:
  simulate:
    cmd: python dvc_sim_runner.py
    deps:
    - path: data/pressure/pic
      md5: 3b0c1e5969643d856f8c1d68710572e3.dir
      size: 84382976
      nfiles: 42
    - path: dvc_sim_runner.py
      md5: bc889f134e926c836e7e833a0f77bb57
      size: 1181
    params:
      params.yaml:
        dataset.pic_path: data/pressure/pic
        dataset.signal_path: data/sensor_signal
        env.phys:
          fiber_sensibility:
            value: 0.6
            accuracy: 4
          kof: 1
          relative_noise: 0.01
          noise: 0.01
        env.sen_geometry:
          distance: 0.5
          x_len: 64
          y_len: 64
          n_angles: 4
          n_spl: 1
        random_seed: 4732
        sim:
          pic_path: data/fiber_loss/pic
          random_rot: 1
          batch_size: 128
          test_size: None
          max_possible_size: 20000
          test_mod: false
    outs:
    - path: data/sensor_signal
      md5: 748006259d0220b30e69963c35303379.dir
      size: 5278976
      nfiles: 42
  learning:
    cmd: python dvc_model_learning.py
    deps:
    - path: data/pressure/pic
      md5: 3b0c1e5969643d856f8c1d68710572e3.dir
      size: 84382976
      nfiles: 42
    - path: data/sensor_signal
      md5: 748006259d0220b30e69963c35303379.dir
      size: 5278976
      nfiles: 42
    - path: dvc_model_learning.py
      md5: e53ad9bb0f6d996b3ba03c09ba539d92
      size: 6671
    params:
      params.yaml:
        train:
          models_path: data/model
          batch_size: 128
          learning_rate: 0.0001
          n_epochs: 5
          model_name: TorchSensorNN
    outs:
    - path: data/model
      md5: 7104a74bfa80a9c176b486e7f87295bb.dir
      size: 13352655
      nfiles: 1
    - path: reports/learning_curve.csv
      md5: 1a4be44391b1d7db2cf3f1e9907d67b1
      size: 221
    - path: reports/summary.json
      md5: 84c294320721b7454d00c910d6f24933
      size: 79
  make_plot:
    cmd: dvc plots show reports/learning_curve.csv --x-label "epochs" --y-label "loss"
    outs:
    - path: dvc_plots/index.html
      md5: e0d4dd43dd0e734d226939eae3da5332
      size: 4481
  evaluate:
    cmd: python dvc_evaluate_model.py
    deps:
    - path: data/model
      md5: 7104a74bfa80a9c176b486e7f87295bb.dir
      size: 13352655
      nfiles: 1
    outs:
    - path: reports/l_curve.png
      md5: feb2186e9d22cee6dc7df5f639afd3c9
      size: 62656
    - path: reports/predict_examples.png
      md5: 452de160a2fa302369c2c0e5daf4734e
      size: 320444
    - path: reports/report.md
      md5: 4deb09523db60548c3e1abfdc5dd0cf8
      size: 643
