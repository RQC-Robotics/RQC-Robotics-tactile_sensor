schema: '2.0'
stages:
  simulate:
    cmd: python dvc_sim_runner.py
    deps:
    - path: data/pressure/batched_pic
      md5: e15f48d4b08a06ddb2ddc24b541e1134.dir
      size: 8192064000
      nfiles: 500
    - path: dvc_sim_runner.py
      md5: 01d0d7f020a712148979871a96168057
      size: 1201
    params:
      params.yaml:
        dataset.pic_path: data/pressure/pic
        dataset.signal_path: data/sensor_signal
        env.phys:
          fiber_sensibility:
            value: 0.6
            accuracy: 5
          kof: 1
          relative_noise: 0.01
          noise: 0.01
        env.sen_geometry:
          distance: 0.5
          x_len: 64
          y_len: 64
          n_angles: 4
          n_spl: 1
        random_seed: 4732
        sim:
          pic_path: data/pressure/batched_pic
          random_rot: 1
          batch_size: 1000
          test_size: None
          test_mod: false
    outs:
    - path: data/sensor_signal
      md5: 0b5c3ae91b073162e9607774940a4305.dir
      size: 512064000
      nfiles: 500
  learning:
    cmd: python dvc_model_learning.py
    deps:
    - path: data/pressure/batched_pic
      md5: a35648ee34a4bc9f81688d2a12a1670c.dir
      size: 16385280
      nfiles: 10
    - path: data/sensor_signal
      md5: caa6c573f62506f4a74d844aebdb91dc.dir
      size: 1025280
      nfiles: 10
    - path: dvc_model_learning.py
      md5: 9b11acde6a6f7b2e7b535a0d9cf6adee
      size: 7260
    params:
      params.yaml:
        train:
          models_path: data/model
          batch_size: 7
          learning_rate: 0.0001
          n_epochs: 20
          model_name: TorchSensorNN5S_norm_deep
    outs:
    - path: data/model
      md5: 43b9992a37c195b8652a478194688843.dir
      size: 16205704
      nfiles: 1
    - path: reports/learning_curve.csv
      md5: 11d32a1e27c0fe94faa926f6d0d9ac13
      size: 840
    - path: reports/summary.json
      md5: fcdb6b1590492f2e26203383d5221d06
      size: 79
  make_plot:
    cmd: dvc plots show reports/learning_curve.csv --x-label "epochs" --y-label "loss"
    outs:
    - path: dvc_plots/index.html
      md5: 4a62d09c25944366f299f99389f59b38
      size: 8347
  evaluate:
    cmd: python3 dvc_evaluate_model.py
    deps:
    - path: data/model
      md5: 0ef1bb24d4242dd46903ac12a4b2a04d.dir
      size: 13352783
      nfiles: 1
    outs:
    - path: reports/l_curve.png
      md5: b62887387552fa6f9955f029da3d0162
      size: 65073
    - path: reports/predict_examples.png
      md5: 066f179c4e09092e1b44a9e027a9d39c
      size: 400472
    - path: reports/report.md
      md5: 4deb09523db60548c3e1abfdc5dd0cf8
      size: 643
  profile_generation:
    cmd: python dvc_pressure_map_gen.py
    deps:
    - path: dvc_pressure_map_gen.py
      md5: b8fe255d50411abdaabf156ca2477885
      size: 2058
    params:
      params.yaml:
        dataset.n_samples: 1000
        dataset.pic_path: data/pressure/pic
        env.pressure_profile:
          n_gauses: 10
          size_kof: 5
          g_param_path: data/gaus_param.npy
        env.sen_geometry.x_len: 64
        env.sen_geometry.y_len: 64
        gengaus:
          batch_size: 100
          save_batch_size: None
        random_seed: 4732
    outs:
    - path: data/pressure/pic
      md5: cda6ee6510eac6d7a9552a9053c6d39f.dir
      size: 16384128
      nfiles: 1
  batch_splitting:
    cmd: python dvc_sim_batch_split.py
    deps:
    - path: data/pressure/pic
      md5: cda6ee6510eac6d7a9552a9053c6d39f.dir
      size: 16384128
      nfiles: 1
    - path: dvc_sim_batch_split.py
      md5: dae4a56be158e37f0f39f0f554e0abd7
      size: 988
    params:
      params.yaml:
        dataset.pic_path: data/pressure/pic
        sim.batch_size: 100
        sim.pic_path: data/pressure/batched_pic
    outs:
    - path: data/pressure/batched_pic
      md5: a35648ee34a4bc9f81688d2a12a1670c.dir
      size: 16385280
      nfiles: 10
  simulation:
    cmd: python dvc_sim_runner.py
    deps:
    - path: data/pressure/batched_pic
      md5: a35648ee34a4bc9f81688d2a12a1670c.dir
      size: 16385280
      nfiles: 10
    - path: dvc_sim_runner.py
      md5: 69e09714290d8bdcdb872ea451e88cc2
      size: 1253
    params:
      params.yaml:
        dataset.pic_path: data/pressure/pic
        dataset.signal_path: data/sensor_signal
        env.phys:
          fiber_sensibility:
            value: 0.6
            accuracy: 5
          kof: 1
          relative_noise: 0.01
          noise: 0.01
        env.sen_geometry:
          distance: 0.5
          x_len: 64
          y_len: 64
          n_angles: 4
          n_spl: 1
        random_seed: 4732
        sim:
          pic_path: data/pressure/batched_pic
          random_rot: 1
          batch_size: 100
          test_size: None
          test_mod: false
    outs:
    - path: data/sensor_signal
      md5: caa6c573f62506f4a74d844aebdb91dc.dir
      size: 1025280
      nfiles: 10
  evaluation:
    cmd: python dvc_evaluate_model.py
    deps:
    - path: data/model
      md5: 43b9992a37c195b8652a478194688843.dir
      size: 16205704
      nfiles: 1
    - path: dvc_evaluate_model.py
      md5: 20d3a531b220234708acdfc04e7700d2
      size: 5013
    outs:
    - path: logsdir
      md5: 944669a51c95446b8874704233f4eac5.dir
      size: 29805
      nfiles: 1
    - path: reports/l_curve.png
      md5: 3b8c356aa202b04d2968e8605d9aab1d
      size: 70767
    - path: reports/predict_examples.png
      md5: 151f481a09c4bd0c221163c2968fb10f
      size: 416069
    - path: reports/report.md
      md5: 9606923c839e9454c879607c84aef0d4
      size: 5162
